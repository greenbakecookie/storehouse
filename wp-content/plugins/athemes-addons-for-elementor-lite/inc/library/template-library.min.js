!function(e,t){window.aafe=window.aafe||{},aafe.translate=function(e,t){return elementorCommon.translate(e,null,t,aafeEditor.i18n)};var a={LibraryViews:{},LibraryModels:{},LibraryCollections:{},LibraryBehaviors:{},LibraryLayout:null,LibraryManager:null};a.LibraryModels.Template=Backbone.Model.extend({defaults:{template_id:0,title:"",type:"",thumbnail:"",url:"",isPro:!1,category:[]}}),a.LibraryCollections.Template=Backbone.Collection.extend({model:a.LibraryModels.Template}),a.LibraryBehaviors.InsertTemplate=Marionette.Behavior.extend({ui:{insertButton:".athemes-addons-templateLibrary-insert-button"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){aafe.library.insertTemplate({model:this.view.model})}}),a.LibraryViews.Loading=Marionette.ItemView.extend({template:"#template-athemes-addons-templateLibrary-loading",id:"athemes-addons-templateLibrary-loading"}),a.LibraryViews.Logo=Marionette.ItemView.extend({template:"#template-athemes-addons-templateLibrary-header-logo",className:"athemes-addons-templateLibrary-header-logo",templateHelpers:function(){return{title:this.getOption("title")}}}),a.LibraryViews.BackButton=Marionette.ItemView.extend({template:"#template-athemes-addons-templateLibrary-header-back",id:"elementor-template-library-header-preview-back",className:"athemes-addons-templateLibrary-header-back",events:function(){return{click:"onClick"}},onClick:function(){aafe.library.showTemplatesView()}}),a.LibraryViews.Menu=Marionette.ItemView.extend({template:"#template-athemes-addons-TemplateLibrary_header-menu",id:"elementor-template-library-header-menu",className:"athemes-addons-TemplateLibrary_header-menu",templateHelpers:function(){return aafe.library.getTabs()},ui:{menuItem:".elementor-template-library-menu-item"},events:{"click @ui.menuItem":"onMenuItemClick"},onMenuItemClick:function(e){aafe.library.setFilter("category",""),aafe.library.setFilter("text",""),aafe.library.setFilter("type",e.currentTarget.dataset.tab,!0),aafe.library.showTemplatesView()}}),a.LibraryViews.EmptyTemplateCollection=Marionette.ItemView.extend({id:"elementor-template-library-templates-empty",template:"#template-athemes-addons-templateLibrary-empty",ui:{title:".elementor-template-library-blank-title",message:".elementor-template-library-blank-message"},modesStrings:{empty:{title:aafe.translate("templatesEmptyTitle"),message:aafe.translate("templatesEmptyMessage")},noResults:{title:aafe.translate("templatesNoResultsTitle"),message:aafe.translate("templatesNoResultsMessage")}},getCurrentMode:function(){return aafe.library.getFilter("text")?"noResults":"empty"},onRender:function(){var e=this.modesStrings[this.getCurrentMode()];this.ui.title.html(e.title),this.ui.message.html(e.message)}}),a.LibraryViews.Actions=Marionette.ItemView.extend({template:"#template-athemes-addons-templateLibrary-header-actions",id:"elementor-template-library-header-actions",ui:{sync:"#athemes-addons-templateLibrary-header-sync i"},events:{"click @ui.sync":"onSyncClick"},onSyncClick:function(){var e=this;e.ui.sync.addClass("eicon-animation-spin"),aafe.library.requestLibraryData({onUpdate:function(){e.ui.sync.removeClass("eicon-animation-spin"),aafe.library.updateBlocksView()},forceUpdate:!0,forceSync:!0})}}),a.LibraryViews.InsertWrapper=Marionette.ItemView.extend({template:"#template-athemes-addons-templateLibrary-header-insert",id:"elementor-template-library-header-preview",behaviors:{insertTemplate:{behaviorClass:a.LibraryBehaviors.InsertTemplate}}}),a.LibraryViews.Preview=Marionette.ItemView.extend({template:"#template-athemes-addons-templateLibrary-preview",className:"athemes-addons-templateLibrary-preview",ui:function(){return{iframe:"> iframe"}},onRender:function(){this.ui.iframe.attr("src",this.getOption("url")).hide();var e=this,t=(new a.LibraryViews.Loading).render();this.$el.append(t.el),this.ui.iframe.on("load",function(){e.$el.find("#athemes-addons-templateLibrary-loading").remove(),e.ui.iframe.show()})}}),a.LibraryViews.TemplateCollection=Marionette.CompositeView.extend({template:"#template-athemes-addons-templateLibrary-templates",id:"athemes-addons-templateLibrary-templates",childViewContainer:"#athemes-addons-templateLibrary-templates-list",emptyView:function(){return new a.LibraryViews.EmptyTemplateCollection},ui:{templatesWindow:".athemes-addons-templateLibrary-templates-window",textFilter:"#athemes-addons-templateLibrary-search",categoryFilter:"#athemes-addons-templateLibrary-filter-category",filterBar:"#athemes-addons-templateLibrary-toolbar-filter"},events:{"input @ui.textFilter":"onTextFilterInput","change @ui.categoryFilter":"onCategoryFilterClick"},getChildView:function(e){return a.LibraryViews.Template},initialize:function(){this.listenTo(aafe.library.channels.templates,"filter:change",this._renderChildren)},filter:function(e){var t=aafe.library.getFilterTerms(),a=!0;return _.each(t,function(t,i){var r=aafe.library.getFilter(i);if(r&&t.callback){var n=t.callback.call(e,r);return n||(a=!1),n}}),a},setMasonrySkin:function(){var e=new elementorModules.utils.Masonry({container:this.$childViewContainer,items:this.$childViewContainer.children()});this.$childViewContainer.imagesLoaded(e.run.bind(e))},onRenderCollection:function(){this.setMasonrySkin(),this.updatePerfectScrollbar()},onTextFilterInput:function(){var e=this;_.defer(function(){aafe.library.setFilter("text",e.ui.textFilter.val())})},onCategoryFilterClick:function(e){var t=e.currentTarget.selectedOptions[0].value;aafe.library.setFilter("category",t)},updatePerfectScrollbar:function(){this.perfectScrollbar||(this.perfectScrollbar=new PerfectScrollbar(this.ui.templatesWindow[0],{suppressScrollX:!0})),this.perfectScrollbar.isRtl=!1,this.perfectScrollbar.update()},onRender:function(){this.$("#athemes-addons-templateLibrary-filter-category").select2({placeholder:"Filter",allowClear:!0,width:200}),this.updatePerfectScrollbar()}}),a.LibraryViews.Template=Marionette.ItemView.extend({template:"#template-athemes-addons-templateLibrary-template",className:"athemes-addons-templateLibrary-template",ui:{previewButton:".athemes-addons-templateLibrary-preview-button, .athemes-addons-templateLibrary-template-preview"},events:{"click @ui.previewButton":"onPreviewButtonClick"},behaviors:{insertTemplate:{behaviorClass:a.LibraryBehaviors.InsertTemplate}},onPreviewButtonClick:function(){aafe.library.showPreviewView(this.model)}}),a.Modal=elementorModules.common.views.modal.Layout.extend({getModalOptions:function(){return{id:"aafeTemplateLibraryModal",hide:{onOutsideClick:!1,onEscKeyPress:!0,onBackgroundClick:!1}}},getTemplateActionButton:function(e){var t=e.isPro&&!aafeEditor.isProActive?"pro-button":"insert-button";return viewId="#template-athemes-addons-templateLibrary-"+t,template=Marionette.TemplateCache.get(viewId),Marionette.Renderer.render(template)},proLabel:function(e){var t=e.isPro&&!aafeEditor.isProActive?"<div class='pro-label'>Pro</div>":"";return t},showLogo:function(e){this.getHeaderView().logoArea.show(new a.LibraryViews.Logo(e))},showDefaultHeader:function(){this.showLogo({title:"aafe"});var e=this.getHeaderView();e.tools.show(new a.LibraryViews.Actions),e.menuArea.show(new a.LibraryViews.Menu)},showPreviewView:function(e){var t=this.getHeaderView();t.logoArea.show(new a.LibraryViews.BackButton),t.tools.show(new a.LibraryViews.InsertWrapper({model:e})),this.modalContent.show(new a.LibraryViews.Preview({url:e.get("url")}))},showBlocksView:function(e){this.modalContent.show(new a.LibraryViews.TemplateCollection({collection:e}))},showTemplatesView:function(e){this.showDefaultHeader(),this.modalContent.show(new a.LibraryViews.TemplateCollection({collection:e}))}}),a.LibraryManager=function(){function i(){var a=e(this).closest(".elementor-top-section"),i=a.data("id"),r=t.documents.getCurrent().container.children,n=a.prev(".elementor-add-section");r&&_.each(r,function(e,t){i===e.cid&&(u.atIndex=t)}),n.find(".elementor-add-aafe-button").length||n.find(FIND_SELECTOR).before($aafeLibraryButton)}function r(e){var t=e.find(FIND_SELECTOR);t.length&&!e.find(".elementor-add-aafe-button").length&&t.before($aafeLibraryButton),e.on("click.onAddElement",".elementor-editor-section-settings .elementor-editor-element-add",i)}function n(e,t){t.addClass("elementor-active").siblings().removeClass("elementor-active")}function o(){var e=window.elementor.$previewContents,t=setInterval(function(){r(e),e.find(".elementor-add-new-section").length>0&&clearInterval(t)},100);e.on("click.onAddTemplateButton",".elementor-add-aafe-button",u.showModal.bind(u)),this.channels.tabs.on("change:device",n)}var l,s,d,m,c,u=this;FIND_SELECTOR=".elementor-add-new-section .elementor-add-section-drag-title",$aafeLibraryButton='<div class="elementor-add-section-area-button elementor-add-aafe-button"><svg width="68" height="57" viewBox="0 0 68 57" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.427 23.0259L0 56.1389H9.29972H20.4594L31.4597 56.1389L16.427 23.0259ZM27.3635 0L18.406 19.1546L35.7109 56.1389H53.6296L27.3635 0Z" fill="#4769D8"/><path d="M68 0H30.9375L38.5488 16.3456H68V0Z" fill="#4769D8"/><path d="M68 39.7189H49.5295L57.1409 56.1389H68V39.7189Z" fill="#4769D8"/><path d="M68 19.859H40.2682L47.8796 36.2055H68V19.859Z" fill="#4769D8"/></svg></div>',this.atIndex=-1,this.channels={tabs:Backbone.Radio.channel("tabs"),templates:Backbone.Radio.channel("templates")},this.updateBlocksView=function(){u.setFilter("category","",!0),u.setFilter("text","",!0),u.getModal().showTemplatesView(d)},this.setFilter=function(e,t,a){u.channels.templates.reply("filter:"+e,t),a||u.channels.templates.trigger("filter:change")},this.getFilter=function(e){return u.channels.templates.request("filter:"+e)},this.getFilterTerms=function(){return{category:{callback:function(e){return _.any(this.get("category"),function(t){return t.indexOf(e)>=0})}},text:{callback:function(e){return e=e.toLowerCase(),this.get("title").toLowerCase().indexOf(e)>=0||_.any(this.get("category"),function(t){return t.indexOf(e)>=0})}},type:{callback:function(e){return this.get("type")===e}}}},this.showModal=function(){u.getModal().showModal(),u.showTemplatesView()},this.closeModal=function(){this.getModal().hideModal()},this.getModal=function(){return l||(l=new a.Modal),l},this.init=function(){u.setFilter("type","section",!0),t.on("preview:loaded",o.bind(this))},this.getTabs=function(){var e=this.getFilter("type");return tabs={section:{title:"Sections"}},_.each(tabs,function(t,a){e===a&&(tabs[e].active=!0)}),{tabs:tabs}},this.getCategory=function(){return s},this.getTypeCategory=function(){var e=u.getFilter("type");return m[e]},this.showTemplatesView=function(){u.setFilter("category","",!0),u.setFilter("text","",!0),d?u.getModal().showTemplatesView(d):u.loadTemplates(function(){u.getModal().showTemplatesView(d)})},this.showPreviewView=function(e){u.getModal().showPreviewView(e)},this.loadTemplates=function(e){u.requestLibraryData({onBeforeUpdate:u.getModal().showLoadingView.bind(u.getModal()),onUpdate:function(){u.getModal().hideLoadingView(),e&&e()}})},this.requestLibraryData=function(e){if(!d||e.forceUpdate){e.onBeforeUpdate&&e.onBeforeUpdate();var t={data:{},success:function(t){d=new a.LibraryCollections.Template(t.templates),t.category&&(s=t.category),t.type_category&&(m=t.type_category),e.onUpdate&&e.onUpdate()}};e.forceSync&&(t.data.sync=!0),elementorCommon.ajax.addRequest("aafe_get_template_library_data",t)}else e.onUpdate&&e.onUpdate()},this.requestTemplateData=function(e,t){var a={unique_id:e,data:{edit_mode:!0,display:!0,template_id:e}};t&&jQuery.extend(!0,a,t),elementorCommon.ajax.addRequest("aafe_get_template_item_data",a)},this.insertTemplate=function(e){var t=e.model,a=this;a.getModal().showLoadingView(),a.requestTemplateData(t.get("template_id"),{success:function(e){a.getModal().hideLoadingView(),a.getModal().hideModal();var i={};-1!==a.atIndex&&(i.at=a.atIndex),$e.run("document/elements/import",{model:t,data:e,options:i}),a.atIndex=-1},error:function(e){a.showErrorDialog(e)},complete:function(e){a.getModal().hideLoadingView(),window.elementor.$previewContents.find(".elementor-add-section .elementor-add-section-close").click()}})},this.showErrorDialog=function(e){if("object"==typeof e){var t="";_.each(e,function(e){t+="<div>"+e.message+".</div>"}),e=t}else e?e+=".":e="<i>&#60;The error message is empty&#62;</i>";u.getErrorDialog().setMessage('The following error(s) occurred while processing the request:<div id="elementor-template-library-error-info">'+e+"</div>").show()},this.getErrorDialog=function(){return c||(c=elementorCommon.dialogsLibraryManager.createWidget("alert",{id:"elementor-template-library-error-dialog",headerMessage:"An error occurred"})),c}},window.aafe.library=new a.LibraryManager,window.aafe.library.init()}(jQuery,window.elementor);