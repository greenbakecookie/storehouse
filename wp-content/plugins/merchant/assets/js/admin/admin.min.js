function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}((m,h,u,p)=>{var f={},v=new URLSearchParams(h.location.search),g=v.get("module");function b(e){return"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e))}m(u).ready(function(){var e=m(".merchant-module-page-ajax-form"),n=m(".merchant-module-page-ajax-header"),a=(m(".merchant-module-save-button"),m(".merchant-module-page-content").on("change keypress change.merchant",function(e){m(e.target).hasClass("merchant-backup-file")||(m(this).is(".merchant-module-question-answer-textarea, .merchant-license-code-input")||f.show_save||(n.addClass("merchant-show"),n.removeClass("merchant-saving"),f.show_save=!0),c.initFlag())}),e.ajaxForm({beforeSubmit:function(){n.addClass("merchant-saving")},success:function(){var t;n.removeClass("merchant-show"),f.show_save=!1,m(".merchant-module-action").hasClass("merchant-enabled")||((t=m(".merchant-module-alert")).addClass("merchant-show"),m(u).off("click.merchant-alert-close"),m(u).on("click.merchant-alert-close",function(e){m(e.target).closest(".merchant-module-alert-wrapper").length||(t.removeClass("merchant-show"),m(u).off("click.merchant-alert-close"))})),m(u).trigger("save.merchant",[g])}}),m(".merchant-module-question-answer-button")),i=m(".merchant-module-question-answer-textarea");i.on("input",function(){a.prop("disabled",""===m(this).val().trim())}),a.on("click",function(e){e.preventDefault();var t,e=i.val();e.trim()?(t=m(this),m(".merchant-module-question-answer-dropdown").removeClass("merchant-show"),m(".merchant-module-question-thank-you-dropdown").addClass("merchant-show"),h.wp.ajax.post("merchant_module_feedback",{subject:i.attr("data-subject"),message:e,module:t.closest(".merchant-module-action").find(".merchant-module-page-button-action-activate").data("module"),nonce:h.merchant.nonce})):alert("Please provide the required information.")}),m(".merchant-module-page-button-action-activate").on("click",function(e){if(e.preventDefault(),m(this).hasClass("merchant-module-deactivated-by-bp"))return!1;m(".merchant-module-question-list-dropdown").removeClass("merchant-show"),m(".merchant-module-question-answer-dropdown").removeClass("merchant-show"),m(".merchant-module-question-answer-form").removeClass("merchant-show"),m(".merchant-module-question-answer-title").removeClass("merchant-show"),m(".merchant-module-question-thank-you-dropdown").removeClass("merchant-show"),m(".merchant-module-question-answer-textarea").val(""),h.wp.ajax.post("merchant_module_activate",{module:m(this).data("module"),nonce:h.merchant.nonce}).done(function(){m("body").removeClass("merchant-module-disabled").addClass("merchant-module-enabled"),m(".merchant-module-action").addClass("merchant-enabled")})}),m(".merchant-module-page-button-action-deactivate").on("click",function(e){e.preventDefault(),h.wp.ajax.post("merchant_module_deactivate",{module:m(this).data("module"),nonce:h.merchant.nonce}).done(function(){m("body").removeClass("merchant-module-enabled").addClass("merchant-module-disabled"),m(".merchant-module-action").removeClass("merchant-enabled"),m(".merchant-module-question-list-dropdown").addClass("merchant-show")})}),m(".merchant-module-question-list-dropdown li").on("click",function(e){a.prop("disabled",""===i.val().trim());var t=m(this),n=t.data("answer-target"),n=m('[data-answer-title="'+n+'"]');n.length?(n.addClass("merchant-show").siblings().removeClass("merchant-show"),m(".merchant-module-question-answer-dropdown").addClass("merchant-show"),m(".merchant-module-question-answer-textarea").attr("data-subject",t.text().trim())):(m(".merchant-module-question-thank-you-dropdown").addClass("merchant-show"),m(".merchant-module-question-answer-dropdown").removeClass("merchant-show")),m(".merchant-module-question-answer-textarea").val(""),m(".merchant-module-question-list-dropdown").removeClass("merchant-show")}),m(".merchant-module-dropdown-close").on("click",function(e){e.preventDefault(),m(this).closest(".merchant-module-dropdown").removeClass("merchant-show")}),m(".merchant-module-page-button-deactivate").on("click",function(e){e.preventDefault();m(this);var t=m(".merchant-module-deactivate-dropdown");t.toggleClass("merchant-show"),m(u).off("click.merchant-close"),m(u).on("click.merchant-close",function(e){m(e.target).closest(".merchant-module-deactivate").length||(t.removeClass("merchant-show"),m(u).off("click.merchant-close"))})}),m(".merchant-range").each(function(){var e=m(this),a=e.find(".merchant-range-input"),i=e.find(".merchant-range-number-input");a.on("change input merchant.range merchant-init.range",function(e){var t=m(this),e=("merchant"===e.type?i:t).val()||0,n=t.attr("min")||0,n=(e-n)/((t.attr("max")||1)-n)*100;m("body").hasClass("rtl")?t.css({background:"linear-gradient(to left, #3858E9 0%, #3858E9 "+n+"%, #ddd "+n+"%, #ddd 100%)"}):t.css({background:"linear-gradient(to right, #3858E9 0%, #3858E9 "+n+"%, #ddd "+n+"%, #ddd 100%)"}),a.val(e),i.val(e)}).trigger("merchant-init.range"),i.on("change input blur",function(){a.hasClass("merchant-range-input")&&a.val(m(this).val()).trigger("merchant.range")})}),m(u).on("click",".merchant-module-page-setting-field-hidden-desc-trigger",function(){var e=m(this),t=(e.toggleClass("expanded"),e.attr("data-show-text")),n=e.attr("data-hidden-text");m(this).find("span:first").text(e.text()===t?n:t),m(this).closest(".merchant-module-page-setting-field").find(".merchant-module-page-setting-field-hidden-desc").stop(!0,!0).slideToggle("fast")});({init:function(){this.events()},events:function(){m(u).on("click","#download-backup-button",this.download.bind(this)),m(u).on("click","#restore-backup-button",this.restore.bind(this)),m(u).on("change","#merchant-backup-file",this.removeBackupFile.bind(this))},download:function(e){var a=this,i=(e.preventDefault(),m(".merchant-module-page-setting-fields .backup-section")),o=(a.hideError(i),m(e.target).attr("data-module-id"));m.ajax({url:merchant_admin_options.ajaxurl,type:"GET",data:{action:"merchant_get_module_settings",nonce:merchant_admin_options.ajaxnonce,module_id:o},beforeSend:function(){a.showLoadingIndicator(i)},success:function(e){var t,n;e.success?(t=e.data,n="merchant-"+o+"-backup-"+(new Date).toISOString().slice(0,10)+"-"+(new Date).getHours()+"-"+(new Date).getMinutes()+"-"+(new Date).getSeconds()+".json",a.downloadJson(t,n)):a.displayError(e.data.message,i),a.hideLoadingIndicator(i)},error:function(e,t,n){a.displayError(n,i),a.hideLoadingIndicator(i)}})},restore:function(e){var t,a=this,i=(e.preventDefault(),m(".merchant-module-page-setting-fields .restore-section")),n=(a.hideError(i),m(e.target).attr("data-module-id")),e=m(".merchant-backup-file").prop("files")[0];e&&"application/json"===e.type?((t=new FileReader).onload=function(e){e=e.target.result;m.ajax({url:merchant_admin_options.ajaxurl,type:"POST",data:{action:"merchant_restore_module_settings",nonce:merchant_admin_options.ajaxnonce,module_id:n,module_settings:e},beforeSend:function(){a.showLoadingIndicator(i)},success:function(e){e.success?h.location.href=e.data.redirect_url:a.displayError(e.data.message,i),a.hideLoadingIndicator(i)},error:function(e,t,n){a.displayError(n,i),a.hideLoadingIndicator(i)}})},t.readAsText(e)):a.displayError(merchant_admin_options.invalid_file,i)},removeBackupFile:function(e){var t,n=m(e.target);n.length&&(e=m(".backup-file-remove"),0<(null==(t=n[0])?void 0:t.files.length)?e.show():e.hide(),e.on("click",function(){n.val(""),m(this).hide()}))},downloadJson:function(e,t){"object"===_typeof(e)&&(e=JSON.stringify(e));var e=new Blob([e],{type:"application/json"}),e=URL.createObjectURL(e),n=u.createElement("a");n.href=e,n.download=t,n.click(),URL.revokeObjectURL(e)},displayError:function(e,t){t.append('<div class="error-message"><p>'.concat(e,"</p></div>"))},hideError:function(e){e.find(".error-message").remove()},showLoadingIndicator:function(e){e.find(".merchant-loading-spinner").addClass("show")},hideLoadingIndicator:function(e){e.find(".merchant-loading-spinner").removeClass("show")}}).init();e={init:function(e){this.events()},events:function(){m(u).on("click",".merchant-flexible-content .merchant-toggle-switch .toggle-switch-label span",function(){var e=m(this).closest(".merchant-toggle-switch").find(".toggle-switch-checkbox");e.prop("checked",!e.prop("checked"))}).trigger("merchant.change")}};({init:function(){this.initiate_datepicker(),this.events()},initiate_datepicker:function(){var e=m(".merchant-module-page-setting-field .merchant-datetime-field");0!==e.length&&e.each(function(n){var a=m(this).find("input"),i={locale:JSON.parse(merchant_datepicker_locale),selectedDates:[a.val()?new Date(a.val()):""],onSelect:function(e){e.date;var t=e.formattedDate;void 0===t&&(e.datepicker.$el.value=""),a.trigger("change.merchant"),a.trigger("change.merchant-datepicker",[t,a,i,n])}},e=m(this).data("options"),e=(e.buttons=["clear"],e&&(e.minDate!==p&&"today"===e.minDate&&(e.minDate=new Date,e.timeZone!==p)&&""!==e.timeZone&&(e.minDate=new Date(e.minDate.toLocaleString("en-US",{timeZone:e.timeZone}))),i=Object.assign(i,e)),new AirDatepicker(a.getPath(),i));a.attr("readonly",!0),m(u).trigger("initiated.merchant-datepicker",[e,a,i,n])})},events:function(){var e=this;m(u).on("merchant-flexible-content-added",function(){e.initiate_datepicker()})}}).init();({init:function(e){this.events()},events:function(){var n=this;m(".merchant-sortable").each(function(){var e=m(this),t=e.find(".merchant-sortable-input");m(e.find("ul.merchant-sortable-list").first()).sortable({update:function(){t.val(n.sortableGetNewVal(e)).trigger("change.merchant")}}).disableSelection().find("li").each(function(){m(this).find("i.visibility").click(function(){m(this).toggleClass("dashicons-visibility-faint").parents("li:eq(0)").toggleClass("invisible")})}).click(function(){m(event.target).hasClass("dashicons-visibility")&&t.val(n.sortableGetNewVal(e)).trigger("change.merchant")})})},sortableGetNewVal:function(e){var e=m(e.find("li")),t=[];return _.each(e,function(e){m(e).hasClass("invisible")||t.push(m(e).data("value"))}),JSON.stringify(t)}}).init(),e.init(),m(u).on("merchant-flexible-content-added",function(e,t){t=t.find(".merchant-sortable-repeater-control").find(".merchant-sortable-repeater.sortable");r.makeFieldsSortable(t)});var o,r={init:function(e){var a=this;m(".merchant-sortable-repeater-control").each(function(){var e=JSON.parse(m(this).find(".merchant-sortable-repeater-input").val()),t=e.length;if(0<t&&(m(this).find(".repeater-input").val(e[0]),1<t))for(var n=1;n<t;++n)a.appendRow(m(this),e[n])}),this.events()},events:function(){var t=this;m(u).on("click",".merchant-sortable-repeater.sortable .customize-control-sortable-repeater-delete",function(e){e.preventDefault(),m(this).parent().slideUp("fast",function(){var e=m(this).parent().parent();m(this).remove(),t.getAllInputs(e)}),m(u).trigger("merchant-sortable-repeater-item-deleted")}),m(u).on("click",".customize-control-sortable-repeater-add",function(e){e.preventDefault(),t.appendRow(m(this).parent()),t.getAllInputs(m(this).parent())}),m(u).on("change",".merchant-sortable-repeater.sortable",function(){t.getAllInputs(m(this).parent())}),m(u).on("focusout",".merchant-sortable-repeater.sortable .repeater-input",function(){t.getAllInputs(m(this).parent())})},appendRow:function(e){var t='<div class="repeater" style="display:none"><input type="text" value="'+(1<arguments.length&&arguments[1]!==p?arguments[1]:"")+'" class="repeater-input" /><span class="dashicons dashicons-menu"></span><a class="customize-control-sortable-repeater-delete" href="#"><span class="dashicons dashicons-no-alt"></span></a></div>',t=(e.find(".sortable").append(t),e.find(".sortable").find(".repeater:last"));t.slideDown("slow",function(){m(this).find("input").focus()}),this.makeFieldsSortable(e.find(".sortable")),m(u).trigger("merchant-sortable-repeater-item-added",[t,e.find(".sortable")])},makeFieldsSortable:function(n){n.hasClass("disable-sorting")||n.sortable({update:function(e,t){r.getAllInputs(n.parent())}})},getAllInputs:function(e){var t=e.find(".repeater-input").map(function(){return m(this).val()}).toArray();t.length||t.push(""),e.find(".merchant-sortable-repeater-input").val(JSON.stringify(t)),e.find(".merchant-sortable-repeater-input").trigger("change"),e.find(".merchant-sortable-repeater-input").trigger("sortable.repeater.change")}},c=(r.init(),{init:function(){this.initAccordion(),this.initFlag()},initAccordion:function(){m(".merchant-group-field.has-accordion").each(function(){var e=m(this);e.accordion({collapsible:!0,header:"> .title-area",heightStyle:"content",active:!!e.hasClass("open")&&0})})},initFlag:function(){m(".merchant-group-field.has-flag").each(function(){var e=m(this),t=e.data("id"),t=e.find(".merchant-field-".concat(t,"_status select")),n=t.val(),t=t.find("option:selected").text();e.find(".field-status").removeClass("hidden active inactive").text(t).addClass(n)})}}),e={accordion:null,activePopupContainer:null,init:function(){this.initAccordion(),this.events(),this.makeSelectedReviewsSortable(m(".merchant-reviews-selector").not(".layouts .merchant-reviews-selector"))},events:function(){var n=this;m(u).on("input",".merchant-reviews-selector .products-search",n.ajaxSearch.bind(n)),m(u).on("change",'.merchant-reviews-selector .product-review input[type="checkbox"]',n.toggleReview.bind(n)),m(u).on("click",".merchant-reviews-selector .review-photo img",n.requestReviewImages.bind(n)),m(u).on("click",".review-photos-popup .overlay",n.dismissImagesGallery.bind(n)),m(u).on("click",".merchant-reviews-selector .product-reviews-load-more button",n.loadMoreReviews.bind(n)),m(u).on("click",".merchant-reviews-selector .popup-trigger",n.initPopUp.bind(n)),m(u).on("click",".merchant-reviews-selector .popup-header .close, .merchant-reviews-selector > .overlay",n.dismissPopUp.bind(n)),m(u).on("click",".merchant-reviews-selector .product-review-delete",n.deleteSelectedReview.bind(n)),m(u).on("keyup",function(e){"Escape"!==e.key||n.dismissImagesGallery()||n.dismissPopUp(n)}),m(u).on("merchant-flexible-content-added",function(e,t){n.makeSelectedReviewsSortable(),n.initAccordion()})},makeSelectedReviewsSortable:function(){var e=0<arguments.length&&arguments[0]!==p?arguments[0]:m(u).find(".merchant-reviews-selector").not(".layouts .merchant-reviews-selector"),n=this;e.find(".selected-reviews .product-reviews").sortable({axis:"y",cursor:"move",helper:"original",handle:".product-review-move",cancel:"",placeholder:"placeholder",update:function(e,t){t=t.item.closest(".merchant-reviews-selector");n.saveModifications(t)},start:function(e,t){t.placeholder.height(t.item.height())}})},deleteSelectedReview:function(e){var e=m(e.target).closest(".product-review"),t=e.closest(".merchant-reviews-selector");e.remove(),this.saveModifications(t),this.updateSelectedReviewsCheckboxState(t),this.countSelectedReviewsInProduct(t)},ajaxSearch:function(e){var t=this,e=m(e.target),n=e.closest(".merchant-reviews-selector"),a=n.find(".popup-header");(0===e.val().length||3<=e.val().length)&&m.ajax({url:merchant_admin_options.ajaxurl,type:"POST",data:{action:"merchant_search_reviews",search:e.val(),nonce:merchant_admin_options.ajaxnonce},beforeSend:function(){a.addClass("loading"),t.destroyAccordion(n)},success:function(e){e.success?(a.removeClass("popup-error"),n.find(".products-search-results").html(e.data),t.initAccordion(n)):a.addClass("popup-error")},complete:function(){a.removeClass("loading")},error:function(){a.addClass("popup-error")}})},loadMoreReviews:function(e){var t=this,n=m(e.target).closest(".product-item"),e=n.find(".product-review").length;m.ajax({url:merchant_admin_options.ajaxurl,type:"POST",data:{action:"merchant_load_more_reviews",product_id:n.attr("data-id"),offset:e,nonce:merchant_admin_options.ajaxnonce},beforeSend:function(){n.addClass("loading")},success:function(e){e.success&&(n.find(".product-reviews .reviews-wrapper").append(e.data.reviews),""===e.data.load_more&&t.hideLoadMoreButton(n),t.updateSelectedReviewsCheckboxState(n.closest(".merchant-reviews-selector")),t.countSelectedReviewsInProduct(n.closest(".merchant-reviews-selector")))},complete:function(){n.removeClass("loading")}})},hideLoadMoreButton:function(e){e.find(".product-reviews-load-more").remove()},initPopUp:function(e){var e=m(e.target).closest(".merchant-reviews-selector"),t=e.find(".selector-popup"),n=e.find(".overlay");t.addClass("active"),n.addClass("active"),this.activePopupContainer=e},dismissPopUp:function(){var e,t=this.activePopupContainer;null!==t&&(e=t.find(".selector-popup"),t=t.find(".overlay"),e.removeClass("active"),t.removeClass("active"),this.activePopupContainer=null)},initAccordion:function(){var e=0<arguments.length&&arguments[0]!==p?arguments[0]:m(u).find(".merchant-reviews-selector"),t=this;e.each(function(){var n=m(this).find(".popup-content .product-item.product-item-has-reviews");n.each(function(){n.accordion({collapsible:!0,heightStyle:"content",icons:!1,active:!!n.hasClass("opened")&&0,activate:function(e,t){t.newPanel.length?t.newPanel.parent().addClass("opened"):n.removeClass("opened")}})}),n.find("a").on("click",function(e){e.stopPropagation()}),t.updateSelectedReviewsCheckboxState(m(this)),t.countSelectedReviewsInProduct(m(this))})},destroyAccordion:function(e){e.find(".selector-popup .product-item.product-item-has-reviews").each(function(){m(this).hasClass("ui-accordion")&&m(this).accordion("destroy")})},toggleReview:function(e){var t=this,n=m(e.target).prop("checked"),a=m(e.target).closest(".merchant-reviews-selector"),e=m(e.target).closest(".product-review"),i=e.attr("data-id"),o=a.find(".selected-reviews .product-reviews"),i=o.find('.product-review[data-id="'.concat(i,'"]'));n?0===i.length&&(n=e.clone(),o.append(n),t.makeSelectedReviewsSortable()):i.remove(),setTimeout(function(){t.saveModifications(a)},150)},saveModifications:function(e){var t=e.find(".review-saved-ids"),n=e.find(".selected-reviews .product-reviews").find(".product-review"),a=[];n.each(function(){var e=m(this).attr("data-id");a.push(e)}),t.val(a.join(",")),t.trigger("change"),this.updateSelectedReviewsCheckboxState(e),this.countSelectedReviewsInProduct(e)},updateSelectedReviewsCheckboxState:function(n){var e=n.find(".selector-popup"),t=n.find(".review-saved-ids"),e=e.find(".product-review"),a=t.val().split(",");e.each(function(){var e=m(this).attr("data-id"),t=n.find('.product-review[data-id="'.concat(e,'"] input[type="checkbox"]'));a.includes(e)?t.prop("checked",!0):t.prop("checked",!1)})},countSelectedReviewsInProduct:function(e){var t=e.find(".selector-popup .product-item"),n=e.find(".review-saved-ids").val().split(",");t.each(function(){var t=0,e=m(this);e.find(".product-review").each(function(){var e=m(this).attr("data-id");n.includes(e)&&t++}),e.find(".selected-reviews-count .counter").text(t)})},requestReviewImages:function(e){var t=m(e.target).closest(".product-review"),n=m(e.target),e=t.attr("data-id");m.ajax({url:merchant_admin_options.ajaxurl,type:"POST",data:{action:"merchant_get_review_images",review_id:e,nonce:merchant_admin_options.ajaxnonce},beforeSend:function(){n.addClass("loading")},success:function(e){e.success&&(m("body").append(e.data),setTimeout(function(){m("body").find(".review-photos-popup").addClass("active")},300))},complete:function(){n.removeClass("loading")}})},dismissImagesGallery:function(){var e=m("body").find(".review-photos-popup");return!!e.length&&(e.removeClass("active"),setTimeout(function(){e.remove()},300),!0)}};({init:function(e){var i=this;m(".merchant-flexible-content-control").each(function(){var e=m(this).hasClass("has-accordion"),n=m(this).find(".merchant-flexible-content"),t=v.get("campaign_id"),a=0;t&&n.find("input.flexible-id").each(function(e){if(m(this).val()===t)return a=e,!1}),e?n.accordion({active:a,collapsible:!0,header:function(e){return e.find(".layout__inner > .layout-header")},heightStyle:"content"}).sortable({axis:"y",cursor:"move",helper:"original",handle:".customize-control-flexible-content-move",stop:function(e,t){n.trigger("merchant.sorted"),i.refreshNumbers(n),n.accordion("refresh")}}):n.sortable({axis:"y",cursor:"move",helper:"original",handle:".customize-control-flexible-content-move",stop:function(e,t){n.trigger("merchant.sorted"),i.refreshNumbers(n),n.accordion("refresh")}})}),this.updateLayoutTitle(),this.updateDiscountPercentMaxVal(),this.events()},updateLayoutTitle:function(){m(".merchant-flexible-content .layout").each(function(){var e,t=m(this).find(".layout-title[data-title-field]");t.length&&((e=m(this).find(".layout-body .merchant-field-"+t.data("title-field")+" input")).on("change keyup",function(){t.text(m(this).val())}),t.text(e.val()))})},updateDiscountPercentMaxVal:function(){m(".merchant-flexible-content .layout").each(function(){var e=m(this),t=e.find('.merchant-module-page-setting-field[data-id="discount_type"]'),n=e.find('.merchant-module-page-setting-field[data-id="discount_value"]'),e=(n=(n=n.length?n:e.find('.merchant-module-page-setting-field[data-id="discount"]')).length?n:e.find('.merchant-module-page-setting-field[data-id="discount_amount"]'),t.find("input:checked").val());"percentage_discount"===e||"percentage"===e?n.find("input").attr("max",100):n.find("input").removeAttr("max")}),m(".merchant-module-page-setting-fields")},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},events:function(){var o=this;function n(e){e&&e.length&&e.siblings().find(".layout-actions__inner").slideUp(300)}m(u).on("change",'.merchant-module-page-setting-field[data-id="discount_type"] input',function(){o.updateDiscountPercentMaxVal()}),m(u).on("change","select",function(){var t=m(this).val(),n=m(this).prop("multiple");m(this).find("option").each(function(){var e=m(this).val(),e=n?t.includes(e):e===t;m(this).attr("selected",e)})}),m(".customize-control-flexible-content-add-button").click(function(e){e.preventDefault(),e.stopImmediatePropagation(),1===m(this).parent().find(".customize-control-flexible-content-add-list a").length?m(this).parent().find(".customize-control-flexible-content-add-list a").trigger("click"):m(this).parent().find(".customize-control-flexible-content-add-list").toggleClass("active")}),m(u).on("click",".customize-control-flexible-content-add",function(e){e.preventDefault(),e.stopImmediatePropagation();var e=m(".merchant-flexible-content-control[data-id="+m(this).data("id")+"]"),t=e.find(".layouts"),n=m(this).data("layout"),t=t.find(".layout[data-type="+n+"]").clone(!0),n=e.find(".merchant-flexible-content"),a=n.find(".layout"),e=o.generateUUID(),e=(t.find("input, select, textarea").each(function(){m(this).data("name")&&m(this).attr("name",m(this).data("name").replace("0",a.length)),m(this).is(":checkbox, :radio")&&m(this).attr("checked")&&m(this).prop("checked",!0)}),t.attr("data-layout-id",e),t.find(".layout-count").text(a.length+1),t.find(".flexible-id").val(e),n.append(t),n.removeClass("empty"),m(this).parent().removeClass("active"),t.find(".merchant-module-page-setting-field-upload").length&&s(t.find(".merchant-module-page-setting-field-upload")),t.find(".merchant-module-page-setting-field-select_ajax").length&&l(t.find(".merchant-module-page-setting-field-select_ajax")),m(this).closest(".merchant-flexible-content-control"));e.hasClass("has-accordion")&&(e.find(".merchant-flexible-content").accordion("refresh"),e.find(".merchant-flexible-content").accordion("option","active",-1)),c.init(),m(u).trigger("merchant-flexible-content-added",[t]),o.updateLayoutTitle(),o.updateDiscountPercentMaxVal()}),m(u).on("click",".customize-control-flexible-content-duplicate",function(e){e.preventDefault(),e.stopImmediatePropagation();var t,a,e=m(this),n=e.closest(".merchant-flexible-content-control[data-id="+e.data("id")+"]"),i=null==n?void 0:n.find(".merchant-flexible-content");n.length&&i.length&&(e=e.closest(".layout")).length&&(e.find(".layout-actions__inner").hide(),t=e.clone(),i.find(".layout"),a=e.find(".layout-count").text(),t.find("input, select, textarea").each(function(){var e,t=m(this),n=t.attr("name");n&&(e=n.split("[")[0],n=n.match(/\[(.*?)\]/g))&&1<n.length&&(n[1]="["+a+"]",e="".concat(e).concat(n.join("")),t.attr("name",e))}),t.find("select").each(function(){m(this).hasClass("select2-hidden-accessible")&&(m(this).removeClass("select2-hidden-accessible").removeAttr("data-live-search").removeAttr("data-select2-id").removeAttr("aria-hidden").removeAttr("tabindex"),m(this).nextAll(".select2-container").remove(),m(this).select2())}),t.find(".layout-body").removeAttr("style"),t.hide(),t.insertAfter(e),t.fadeIn(),t.find(".merchant-module-page-setting-field-upload").length&&s(t.find(".merchant-module-page-setting-field-upload")),t.find(".merchant-module-page-setting-field-select_ajax").length&&l(t.find(".merchant-module-page-setting-field-select_ajax")),o.refreshNumbers(i),m(u).trigger("merchant-flexible-content-added",[t]),n.hasClass("has-accordion")&&i.accordion("refresh"),o.updateLayoutTitle(),c.init())}),m(u).on("click",".customize-control-flexible-content-delete",function(e){e.preventDefault();var e=m(this).closest(".layout"),t=e.parent(),t=(e.remove(),0===t.find(".layout").length&&t.addClass("empty"),o.refreshNumbers(t),m(u).trigger("merchant-flexible-content-deleted",[e]),m(this).closest(".merchant-flexible-content-control"));t.hasClass("has-accordion")&&t.find(".merchant-flexible-content").accordion("refresh"),m(u).trigger("change.merchant")}),m(u).on("click",".layout-actions__toggle",function(e){e.preventDefault(),n(m(this).closest(".layout")),m(this).closest(".layout-actions").find(".layout-actions__inner").stop().slideToggle(300)}),m(u).on("click",".layout-header",function(){n(m(this).closest(".layout"))}),m(u).on("merchant-flexible-content-added",function(e,t){n(t)})},refreshNumbers:function(e){e.find(".layout").each(function(e){var t=m(this).find(".layout-count").text(),n=parseInt(t)-1;m(this).find(".layout-count").text(e+1),m(this).find("input, select, textarea").each(function(){m(this).attr("name")&&m(this).attr("name",m(this).attr("name").replace("["+n+"]","[*refreshed*"+e+"]"))})}),e.find(".layout").each(function(e){m(this).find("input, select, textarea").each(function(){var e=m(this).attr("name");e&&m(this).attr("name",e.replace("*refreshed*",""))})}),e.parent().find("input").trigger("change.merchant")}}).init(),c.init(),e.init(),m(u).on("keyup",".merchant-module-page-setting-field-products_selector .merchant-search-field",function(){clearTimeout(o);var e,t,n,a=[],i=(!m(this).closest('[data-id="excluded_products"]').length||"categories"!==(t=(e=m(this).closest(".layout")).find(".merchant-field-rules_to_apply select").val()||e.find(".merchant-field-rules_to_display select").val()||e.find(".merchant-field-display_rules select").val())&&"by_category"!==t||(a=e.find(".merchant-field-category_slugs select").val()||e.find(".merchant-field-product_cats select").val()),m(this).closest(".merchant-products-search-container"));""!==m(this).val()?(i.find(".merchant-searching").addClass("active"),n={action:"merchant_admin_products_search",nonce:merchant_admin_options.ajaxnonce,keyword:m(this).val(),product_types:m(this).data("allowed-types"),ids:i.find(".merchant-selected-products").val(),categories:a},o=setTimeout(function(){m.post(merchant_admin_options.ajaxurl,n,function(e){var t=i.find(".merchant-selections-products-preview");t.show(),t.html(e),i.find(".merchant-searching").removeClass("active")})},250)):i.find(".merchant-selections-products-preview").html("").hide()}),m(u).on("click touch",".merchant-module-page-setting-field-products_selector .merchant-selections-products-preview li",function(){var e=m(this).closest(".merchant-products-search-container"),t=e.find(".merchant-selected-products"),n=t.val(),a="multiple"===e.data("multiple");0<e.find(".merchant-selected-products-preview ul li").length&&!a&&(e.find(".merchant-selected-products-preview ul li").remove(),t.val("").change()),m(this).children(".remove").attr("aria-label","Remove").html("×"),e.find(".merchant-selected-products-preview ul").append(m(this)),e.find(".merchant-selections-products-preview").html("").hide(),e.find(".merchant-search-field").val("").change(),""===n?t.val(m(this).data("id")):(a?((e=n.split(",")).push(m(this).data("id")),t.val(e.join(","))):t.val(m(this).data("id"))).change()}),m(u).on("click touch",".merchant-selected-products-preview .remove",function(){var e=m(this);if(confirm(merchant_admin_options.product_delete_confirmation_message)){var t=e.closest(".merchant-products-search-container").find(".merchant-selected-products"),n=e.parent().data("id"),a=(e.parent().remove(),t.val().split(","));if(0<a.length)for(var i in a)parseInt(a[i])===parseInt(n)&&a.splice(i,1);t.val(a.join(",")).change(),t.trigger("change.merchant")}}),m(u).on("merchant-admin-check-fields merchant-flexible-content-added",function(){m(".merchant-module-page-setting-field").each(function(){var e=m(this);if(e.data("condition")&&e.data("condition").length){var t=e.data("condition"),n=m(this).closest(".layout-body").find('input[name*="'+t[0]+'"],select[name*="'+t[0]+'"]');if((n=n.length?n:m('input[name="merchant['+t[0]+']"],select[name="merchant['+t[0]+']"]')).length){var a,i=!1;switch(t[1]){case"==":"radio"!==n.attr("type")&&"checkbox"!==n.attr("type")||(a=n.parent().find("input:checked")).length&&a.val()===t[2]&&(i=!0),n.is("select")&&n.val()==t[2]&&(i=!0);break;case"any":"radio"!==n.attr("type")&&"checkbox"!==n.attr("type")||(a=n.parent().find("input:checked")).length&&t[2].split("|").includes(a.val())&&(i=!0),n.is("select")&&t[2].split("|").includes(n.val())&&(i=!0)}i?e.removeClass("merchant-hide").addClass("merchant-show"):e.removeClass("merchant-show").addClass("merchant-hide")}}})}).trigger("merchant.change"),m(u).on("merchant-admin-check-fields merchant-flexible-content-added change keyup",function(){m(u).find(".merchant-module-page-setting-field").each(function(){var e=m(this);e.data("conditions")&&(function e(t){var n=1<arguments.length&&arguments[1]!==p&&arguments[1];var a=!1;if("relation"in t){var i=t.relation.toUpperCase();if("OR"===i)for(var o=0;o<t.terms.length;o++){var r=t.terms[o];if(a=e(r,n))return!0}else if("AND"===i){for(var c=0,s=0;s<t.terms.length;s++){var l=t.terms[s];e(l,n)&&c++}c===t.terms.length&&(a=!0)}}else{var d,i="",h=(i="terms"in t?t.terms[0]:t,m('input[name="merchant['+i.field+']"],select[name="merchant['+i.field+']"]')),u=(h.length||0<(d=n.closest(".layout-body")).length&&(h=d.find(".merchant-field-"+i.field).find("input, select")),(h=(h=h.length?h:m('input[name="merchant['+i.field+'][]"],select[name="merchant['+i.field+'][]"]')).length?h:m(".merchant-group-fields-container").find(".merchant-field-"+i.field+' input[name*="'+i.field+'"],.merchant-field-'+i.field+' select[name*="'+i.field+'"]')).val());"checkbox"===h.attr("type")&&(u=h.is(":checked")),"radio"===h.attr("type")&&(u=h.filter(":checked").val()),"checkbox"===h.attr("type")&&1<h.length&&(u=[],h.each(function(){m(this).is(":checked")&&u.push(m(this).val())})),b(u)&&(u=Number(u)),Array.isArray(i.value)&&(i.value=i.value.map(function(e){return b(e)?Number(e):e})),("==="===i.operator&&u===i.value||"!=="===i.operator&&u!==i.value||">"===i.operator&&u>i.value||"<"===i.operator&&u<i.value||">="===i.operator&&u>=i.value||"<="===i.operator&&u<=i.value||"in"===i.operator&&i.value.includes(u)||"!in"===i.operator&&!i.value.includes(u)||"contains"===i.operator&&Array.isArray(u)&&u.includes(i.value)||"!contains"===i.operator&&Array.isArray(u)&&!u.includes(i.value))&&(a=!0)}return a}(e.data("conditions"),e)?e.removeClass("merchant-hide").addClass("merchant-show"):e.removeClass("merchant-show").addClass("merchant-hide"))})}).trigger("merchant.change"),m(u).on("change",".merchant-module-page-setting-field",function(){m(u).trigger("merchant-admin-check-fields")}).trigger("merchant.change"),m(u).trigger("merchant-admin-check-fields"),m(u).on("merchant-admin-check-color-fields merchant-flexible-content-added",function(){m(".merchant-color").each(function(){var n,e=m(this),a=e.find(".merchant-color-picker"),i=e.find(".merchant-color-input"),o=!1;a.off("click").on("click",function(e){e.preventDefault(),e.stopPropagation();var t=m("body,html");t.addClass("merchant-height-auto"),o?n.setColor(i.val()):((n=new Pickr({el:a.get(0),container:"body",theme:"merchant",appClass:"merchant-pcr-app",default:i.val()||a.data("default-color")||"#212121",swatches:["#000000","#F44336","#E91E63","#673AB7","#03A9F4","#8BC34A","#FFEB3B","#FFC107","#FFFFFF"],sliders:"h",useAsButton:!0,components:{hue:!0,preview:!0,opacity:!0,interaction:{input:!0,clear:!0}},i18n:{"btn:clear":"Default"}})).on("change",function(e){e=(1===e.a?(n.setColorRepresentation("HEX"),e.toHEXA()):(n.setColorRepresentation("RGBA"),e.toRGBA())).toString(0);a.css({"background-color":e}),i.val()!==e&&i.val(e).trigger("change.merchant"),m(u).trigger("merchant-color-picker-updated",[e,i])}),n.on("clear",function(){var e=a.data("default-color");e?n.setColor(e):(a.css({"background-color":"white"}),i.val(""))}),n.on("hide",function(){t.removeClass("merchant-height-auto")}),a.data("pickr",n),setTimeout(function(){n.show()},200),o=!0)}),i.on("change keyup",function(){var e=m(this).val();a.css({"background-color":e})})})}),m(u).trigger("merchant-admin-check-color-fields");({init:function(){this.events()},events:function(){var l=this;m(u).on("click",".merchant-create-page-control-button",function(e){e.preventDefault();var t=m(this),n=t.parent().find(".merchant-create-page-control-create-message"),a=t.parent().find(".merchant-create-page-control-success-message"),e=(t.text(),t.data("creating-text")),i=(t.data("created-text"),t.data("page-title")),o=t.data("page-meta-key"),r=t.data("page-meta-value"),c=t.data("option-name"),s=t.data("nonce");if(!i)return!1;m(this).text(e),m(this).attr("disabled",!0),m.ajax({type:"post",url:ajaxurl,data:{action:"merchant_create_page_control",page_title:i,page_meta_key:o,page_meta_value:r,option_name:c,nonce:s},success:function(e){l.ajaxResponseHandler(e,t,a,n)}})})},ajaxResponseHandler:function(e,t,n,a){"success"===e.status&&(e=n.find("a").attr("href").replace("?post=&","?post="+e.page_id+"&"),n.find("a").attr("href",e),n.css("display","block"),a.remove(),t.remove())}}).init(),m(".merchant-module-page-setting-field-gallery").each(function(){var a,i=m(this),e=i.find(".merchant-gallery-button"),o=i.find(".merchant-gallery-input"),r=i.find(".merchant-gallery-images"),t=i.find(".merchant-gallery-remove");r.sortable({helper:"original",update:function(e,t){var n=[];r.find(".merchant-gallery-image").each(function(){n.push(m(this).data("item-id"))}),o.val(n.join(",")).trigger("change")}});t.on("click",function(e){e.preventDefault(),m(this).parent().remove();var t=[];r.find(".merchant-gallery-image").each(function(){t.push(m(this).data("item-id"))}),o.val(t.join(",")).trigger("change")}),e.on("click",function(e){m(this);var t=o.val(),n=t?"edit":"add";e.preventDefault(),void 0!==h.wp&&h.wp.media&&h.wp.media.gallery&&("add"==n?(a=h.wp.media({library:{type:"image"},frame:"post",state:"gallery",multiple:!0})).open():a=h.wp.media.gallery.edit('[gallery ids="'+t+'"]'),a.on("update",function(e){r.empty();e=e.models.map(function(e){var e=e.toJSON(),t=(e.sizes&&e.sizes.thumbnail&&e.sizes.thumbnail.url?e.sizes.thumbnail:e).url;return r.append('<div class="merchant-gallery-image" data-item-id="'+e.id+'"><i class="merchant-gallery-remove dashicons dashicons-no-alt"></i><img src="'+t+'" /></div>'),e.id});o.val(e.join(",")).trigger("change"),i.find(".merchant-gallery-remove").on("click",function(e){e.preventDefault(),m(this).parent().remove();var t=[];r.find(".merchant-gallery-image").each(function(){t.push(m(this).data("item-id"))}),o.val(t.join(",")).trigger("change")})}))})});var s=function(e){var a,i=e,e=i.find(".merchant-upload-button"),o=i.find(".merchant-upload-input"),r=i.find(".merchant-upload-wrapper");i.find(".merchant-upload-remove").on("click",function(e){e.preventDefault(),m(this).parent().remove(),o.val("").trigger("change")}),e.on("click",function(e){e.preventDefault(),void 0!==h.wp&&h.wp.media&&((a=a||h.wp.media({library:{type:"image"}})).open(),a.on("select",function(){r.empty();var e=a.state().get("selection").first().attributes,t=(e.sizes&&e.sizes.thumbnail&&e.sizes.thumbnail.url?e.sizes.thumbnail:e).url,n=e.sizes?JSON.stringify(e.sizes):"";r.append('<div class="merchant-upload-image" data-sizes=\''+n+'\'><i class="merchant-upload-remove dashicons dashicons-no-alt"></i><img src="'+t+'" /></div>'),o.val(e.id).trigger("change"),i.find(".merchant-upload-button-drag-drop").hide(),i.find(".merchant-upload-remove").on("click",function(e){e.preventDefault(),m(this).parent().remove(),o.val("").trigger("change"),i.find(".merchant-upload-button-drag-drop").show()})}))})},l=(m(".merchant-module-page-setting-field-upload:not(.template)").each(function(){s(m(this))}),jQuery.each(["dragenter","dragover","dragleave","drop"],function(e,t){m(u).on(t,".merchant-upload-button-drag-drop",function(e){e.preventDefault(),e.stopPropagation()})}),m(u).on("dragenter",".merchant-upload-button-drag-drop",function(e){m(this).closest(".merchant-module-page-setting-field-upload").find(".merchant-upload-button").click()}),function(e){var t=e.find("select"),n=t.data("source"),a=h.merchant_admin_options,i={width:"100%",templateSelection:function(e){return e.text.replace(/&nbsp;-*\s*/g,"").trim()}};"post"!==n&&"product"!==n&&"user"!==n||(i.minimumInputLength=1,i.ajax={url:a.ajaxurl,dataType:"json",delay:250,cache:!0,data:function(e){return{action:"merchant_admin_options_select_ajax",nonce:a.ajaxnonce,term:e.term,source:n}},processResults:function(e,t){return e.success?{results:e.data}:{}}}),t.select2(i),e.find(".select2-selection--multiple").append('<span class="merchant-select2-clear"></span>')}),d=(m(".merchant-module-page-setting-field-select_ajax:not(.template)").each(function(){l(m(this))}),m(".merchant-module-page-settings-responsive").each(function(){var e=m(this),n=e.find(".merchant-module-page-settings-devices button"),a=e.find(".merchant-module-page-settings-device-container");n.on("click",function(e){e.preventDefault();var t=m(this).data("device");n.removeClass("active"),a.removeClass("active"),m(this).addClass("active"),a.each(function(){m(this).data("device")===t&&m(this).addClass("active")})})}),m(".merchant-animated-buttons").each(function(){var e,t,n=m(this).find("label"),a=m(".merchant-animation-demo");n.on("click",function(){a.removeClass("merchant-animation-"+e),a.removeClass("merchant-animation-"+t),e=m(this).find("input").attr("value"),setTimeout(function(){a.addClass("merchant-animation-"+e)},100),setTimeout(function(){a.removeClass("merchant-animation-"+e)},1e3)}),n.mouseover(function(){a.removeClass("merchant-animation-"+e),t=m(this).find("input").attr("value"),a.addClass("merchant-animation-"+t)}).mouseout(function(){a.removeClass("merchant-animation-"+t)})}),m(".merchant-notifications-sidebar")),e=(d.length&&(m(".merchant-notifications").on("click",function(e){e.preventDefault();var t=m(this),e=d.find(".merchant-notification:first-child .merchant-notification-date").data("raw-date");d.toggleClass("opened"),t.hasClass("read")||m.post(h.merchant.ajax_url,{action:"merchant_notifications_read",nonce:h.merchant.nonce,latest_notification_date:e},function(e){e.success&&setTimeout(function(){t.addClass("read")},2e3)})}),m(h).on("scroll",function(){60<h.pageYOffset&&(d.addClass("closing"),setTimeout(function(){d.removeClass("opened"),d.removeClass("closing")},300))}),m(".merchant-notifications-sidebar-close").on("click",function(e){e.preventDefault(),d.addClass("closing"),setTimeout(function(){d.removeClass("opened"),d.removeClass("closing")},300)})),m(".merchant-tabs-nav")),t=(e.length&&e.each(function(){var n=m(this).data("tab-wrapper-id");m(this).find(".merchant-tabs-nav-link").on("click",function(e){e.preventDefault();var e=m(this).closest(".merchant-tabs-nav").find(".merchant-tabs-nav-link"),t=m(this).data("tab-to"),e=(e.each(function(){m(this).closest(".merchant-tabs-nav-item").removeClass("active")}),m(this).closest(".merchant-tabs-nav-item").addClass("active"),m('.merchant-tab-content-wrapper[data-tab-wrapper-id="'+n+'"]'));e.find("> .merchant-tab-content").removeClass("active"),e.find('> .merchant-tab-content[data-tab-content-id="'+t+'"]').addClass("active")})}),m(".merchant-module-alert"));t.length&&t.find(".merchant-module-alert-close").on("click",function(e){e.preventDefault(),t.removeClass("merchant-show"),m(u).off("click.merchant-alert-close")})})})(jQuery,window,document),jQuery.fn.extend({getPath:function(){var c=[];return this.each(function(e,t){for(var n,a=jQuery(t);a.length;){var i=a.get(0);if(!(o=i.localName))break;var o=o.toLowerCase(),r=a.parent();1<r.children(o).length&&0<(e=r.children().index(i)+1)&&(o+=":nth-child("+e+")"),n=o+(n?" > "+n:""),a=r}c.push(n)}),c.join(",")}});